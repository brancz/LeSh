<!DOCTYPE html>
<html>
  <head>
    <title>LeSh</title>
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/css/bootstrap.min.css" />
    <style>
      .hasErrors {
        border: 1px solid #d9534f;
      }
    </style>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js" type="text/javascript"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/zeroclipboard/2.1.6/ZeroClipboard.min.js" type="text/javascript"></script>
    <script>
        $(function() {
            $('#lookup-button').click(function() {
                var linkId = $('#link-id').val();
                $.ajax({
                    type: 'GET',
                    url: '/api/links/' + linkId,
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function(data, status, xhr) {
                        $('#link').html('<a href="' + data.uri + '">' + data.uri + '</a>');
                    },
                    error: function(xhr, status, error) {
                        console.log(xhr.responseJSON.errors);
                    }
                });
            });
            $('#button_shorten').click(function() {
                var link = $('#link_uri').val();
                $.ajax({
                    type: 'POST',
                    url: '/api/links',
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    data: JSON.stringify({uri: link}),
                    success: function(data, status, xhr) {
                        $('#shortened_link').val(data.internal_uri);
                        $('#errors').html('');
                        $('#link_uri').removeClass('hasErrors');
                        $('#copy_button').tooltip('destroy').tooltip({
                            container: 'body',
                            title: 'click here to copy',
                            placement: 'right',
                            trigger: 'manual'
                        }).tooltip('show');
                        setTimeout(function() {
                            $('#copy_button').tooltip('hide');
                        }, 3000);
                    },
                    error: function(xhr, status, error) {
                        error_list = '<ul>';
                        errors = xhr.responseJSON.errors;
                        errors.forEach(function(error) {
                            error_list += '<li>';
                            error_list += error;
                            error_list += '</li>';
                        });
                        error_list += '</ul>';
                        $('#errors').html(error_list);
                        $('#link_uri').addClass('hasErrors');
                    }
                });
            });
            var client = new ZeroClipboard(document.getElementById("copy_button"));
            client.on("ready", function(readyEvent) {
                client.on("copy", function(event) {
                    var clipboard = event.clipboardData;
                    clipboard.setData("text/plain", $('#shortened_link').val());
                    $('#copy_button').tooltip('destroy').tooltip({
                        container: 'body',
                        title: 'copied!',
                        placement: 'right',
                        trigger: 'manual'
                    }).tooltip('show');
                    setTimeout(function() {
                        $('#copy_button').tooltip('hide');
                    }, 3000);
                });
            });
            $('#lookup-link').click(function() {
                $('#lookup-link').hide();
                $('#back-link').show();
                $('#main').hide();
                $('#lookup').show();
            });
            $('#back-link').click(function() {
                $('#back-link').hide();
                $('#lookup-link').show();
                $('#lookup').hide();
                $('#main').show();
            });
        });
    </script>
  </head>
  <body>
    <div class="container" style="padding-top: 40px;">
      <div class="row">
        <div class="col-lg-6 col-lg-offset-3 well">
          <h1 class="text-center">LeSh</h1>
          <h2 class="text-center" style="margin-bottom: 30px;">Le Link Shortener</h2>
          <div id="main">
            <div class="input-group" style="margin-bottom: 10px;">
              <input class="form-control" id="link_uri" placeholder="e.g. http://google.com" type="text" />
              <span class="input-group-btn">
                <input class="btn btn-default" id="button_shorten" type="submit" value="Shorten" style="width: 80px;" />
              </span>
            </div>
            <div id="errors" style="color: #d9534f;"></div>
            <div class="input-group">
              <input class="form-control" id="shortened_link" type="text" />
              <span class="input-group-btn">
                <button id="copy_button" class="btn btn-default" type="button" style="width: 80px;">
                  <span>Copy</span>
                </button>
              </span>
            </div>
          </div>
          <div id="lookup" style="display: none;">
            <div class="input-group">
              <span class="input-group-addon">http://localhost:5000/</span>
              <input id="link-id" type="text" class="form-control">
              <span class="input-group-btn">
                <button id="lookup-button" class="btn btn-default" type="button">Go!</button>
              </span>
            </div>
            <div id="link" class="text-center" style="margin-top: 10px;"></div>
          </div>
          <div id="switcher" class="clearfix" style="margin-top: 10px;">
            <a id="back-link" class="pull-left" style="display: none;">Back</a>
            <a id="lookup-link" class="pull-right">Lookup a link</a>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
